.SILENT:

TEST_INFO="Dispatcher concepts comparison tests"
GENERATION_OPTIONS=WITH_TITLE=0 GENERATE_SUBDIAGRAMS=0
TMP_DIR=/tmp/dispatcher
TIME=/usr/bin/time
TEST_ASPECTS="compilation size strip-size execution valgrind"
CXXFLAGS="-m32"

ifndef FRAMEWORKS
	FRAMEWORKS=\
		framework_MetaIfElse\
		framework_SwitchCase\
		framework_JumpTable..STD_MAP\
		framework_JumpTable..BOOST_UNORDERED_MAP\
		framework_JumpTable..RAW_TABLE\

endif

ifndef EVENT_CALLS
	EVENT_CALLS = 10000000
endif

ifndef TESTS
	TESTS=\
		test_dispatch
endif

#EXPECTED_EVENTS - events which will be registered in test
#GIVEN_EVENTS - events from which events will be generated (there will be EVENT_CALLS events)

.PHONY: tests
tests: optimaliations debug

.PHONY: optimaliations
optimaliations:
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
#
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
#
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
#
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -O2 -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -Os -DNDEBUG -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test

.PHONY: debug
debug:
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++44" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test
#
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(2)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)(977)' -DGIVEN_EVENTS='(2)(11)(23)(41)(59)(73)(97)(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)(367)(389)(419)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(2)(977)' -DGIVEN_EVENTS='(2)(11)(997)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)'" test
	@make CXX="g++34" CXXFLAGS="$(CXXFLAGS) -g -DEXPECTED_EVENTS='(109)(137)(157)(179)(197)(227)(241)(269)(283)(313)(347)' -DGIVEN_EVENTS='(347)(367)(389)(419)(977)'" test

